#include <windows.h>
#include <conio.h>
#include <stdio.h>
#include <ctype.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <limits.h>



int menu(int i)
{
	printf("Програма \n");
	printf("1. Избор на входен файл за обработка\n");
	printf("2. Показване съдържанието на файла\n");
	printf("3. Преброяване на символите от файла и записа им в таблица\n");
	printf("4. Брой на срещане на избран символ спрямо общ брой символи\n");
	printf("5. Замяна на избран символ с друг и записа му в нов файл\n");
	printf("6. Обработка на числова информация\n");
	printf("7. Изход\n");
	do
	{
		printf("\nВашият избор:");
		scanf("%d", &i);
	} while (i<1 || i>7);

	return i;
}

int cmenu(int j)
{
	printf("\n\n*Числова обработка*\n");
	printf("1. Намиране на минимална и максимална стоиност от всички записани числа\n");
	printf("2. Запис на всички числа лежащи в даден интервал\n");
	printf("3. Средно-аритметична стойност на всички числа\n");
	printf("4. Замяна на всички отрицателни числа с 0 и записа им в нов файл\n");
	printf("5. <---Назад\n");

	do
	{
		printf("Изберете моля:\n");
		scanf("%d", &j);
	} while (j<1 || j>5);

	return j;
}


#include <windows.h>
#include <conio.h>
#include <stdio.h>
#include <ctype.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <limits.h>

void count(FILE *f, char d)
{
	char c;
	float b = 0, i = 0, v = 0;
	rewind(f);
	do
	{
		c = fgetc(f);
		if (ferror(f))
		{
			perror("Грешка:");
		}
		i++;
	} while (c != EOF);
	rewind(f);
	do
	{
		c = fgetc(f);
		if (ferror(f))
		{
			perror("Грешка:");
		}
		if (c == d)
		{
			b++;
		}
	} while (c != EOF);
	v = (b / i);
	printf("\nОбщ брой символи:%0.0f\nСимволът *%c* се среща %0.0f пъти\n%0.2f%% спрямо общия брой\n\n", i, d, b, v);

}

void replace(FILE *fi, FILE *fo)
{

	char c, ch1, ch2;
	rewind(fi);
	fo = fopen("C:\\t.txt", "w");
	if (fo == NULL)
	{
		printf("Грешка");
	}

	printf("\nВъведете символ за замяна:");
	scanf("%c", &ch1);
	ch1 = getche();
	printf("\nЗамени с:");
	ch2 = getchar();
	while (1)
	{
		c = fgetc(fi);
		if (ferror(fi))
		{
			perror("Грешка:");
		}
		if (c == EOF){ break; }
		if (c == ch1)
		{
			fputc(ch2, fo);
		}
		else
		{
			fputc(c, fo);
		}
	}
	if (fo != NULL){ printf("\nГотово\n\n"); }
}

void maxi(FILE *f)
{
	int n;
	int min = INT_MAX, max = INT_MIN;
	int flag = 0;
	rewind(f);

	while (fscanf(f, "%d", &n) != EOF)
	{
		if (ferror(f))
		{
			perror("Грешка:");
		}
		if (flag == 0)
		{
			min = n;
			max = n;
			flag = 1;
		}
		if (min>n)
			min = n;
		if (max<n)
			max = n;
	}
	printf("\nМаксимална стойност: %d\nМинимална стойност: %d\n", max, min);
}

void interval(FILE *f)
{
	int x, y;
	int n = 0;
	int k = 0;
	int m = 0;
	FILE *fo;
	rewind(f);
	fo = fopen("C:\\Users\\HP\\Desktop\\1\\1\\t.txt", "w");
	if (fo == NULL)
	{
		printf("Грешка");
	}

	printf("\nВъведете начало на интервала:");
	scanf("%d", &x);
	printf("\nВъведете край на интервала:");
	scanf("%d", &y);
	printf("\nЖелан брой колони:");
	scanf("%d", &k);

	while (fscanf(f, "%d", &n) != EOF)
	{
		if (ferror(f))
		{
			perror("Грешка:");
		}
		if (n>x && n<y)
		{
			if (m<k)
			{
				fprintf(fo, "%d\t", n);
				m++;
			}
			else
			{
				fprintf(fo, "\n%d\t", n);
				m = 1;
			}
		}
	}
}

void tablica(FILE *f, FILE *fo)
{
	short count[256] = { 0 };
	int c, k = 0;

	rewind(f);
	fo = fopen("C:\\Users\\HP\\Desktop\\1\\1\\t.txt", "w");
	if (fo == NULL) { printf("Грешка"); }
	while (1)
	{
		c = fgetc(f);
		if (ferror(f))
		{
			perror("Грешка:");
		}
		if (c == EOF)break;
		count[c]++;
	}
	printf("СИМВОЛ|ASCII-DEC|ASCII-HEX|BROI");
	fprintf(fo, "СИМВОЛ|ASCII-DEC|ASCII-HEX|BROI");
	for (k = 0; k<256; k++)
	{
		if (count[k] > 0)
		{
			printf("     %c     %u        %x     %d\n", k, k, k, count[k]);
			fprintf(fo, "     %c     %u        %x     %d\n", k, k, k, count[k]);
		}
	}
}

void sred(FILE *f)
{
	long int n, sum = 0, b = 0;
	char m[256], *m1;
	rewind(f);
	while (fscanf(f, "%s", m) != EOF)
	{
		if (ferror(f))
		{
			printf("Oh dear, something went wrong with read()! %s\n", strerror(errno));
			perror("Грешка:");
		}

		n = strtol(m, &m1, 10);
		if (errno == 34)
		{
			printf("Препълване на входа");
		}
		else
		{
			if (n >= 0 && sum >= 0 && (INT_MAX - n <= sum) || n <= 0 && sum <= 0 && (INT_MIN - n>sum))
			{
				printf("\n!!Препълване при събиране!!\n");
				_getch();
				exit(0);

			}

			else
			{
				sum = sum + n;
				b++;
				/*	if (errno == 34)
				{
				printf("Oh dear, something went wrong with read()! %s\n", strerror(errno));
				printf("\n!!Препълшане!!\n");
				}*/
			}


		}
	}

}

void otr(FILE *f, FILE *fo)
{
	int n, c, b = 0;
	//Разделителят е интервал (32)
	rewind(f);

	fo = fopen("C:\\Users\\HP\\Desktop\\1\\1\\t.txt", "w");
	if (fo == NULL)
	{
		printf("Грешка!");
	}
	while (fscanf(f, "%d", &n) != EOF)
	{
		if (ferror(f))
		{
			perror("Грешка:");
		}
		if (n<0)
		{
			n = 0;
			fprintf(fo, "%d%c", n, ' ');
		}
		else
		{
			fprintf(fo, "%d%c", n, ' ');
		}
	}
	if (fo != NULL)
	{
		printf("\nГотово\n\n");
	}
}

FILE *file(char name[30])
{
	FILE *fp;

	printf("Въведете име на файла:");
	scanf("%s", name);

	fp = fopen(name, "r");
	if (fp == 0)
	{
		printf("\nНесъществуващ файл!!");
	}
}

void tekst(FILE *fp)
{
	char line[512];
	rewind(fp);
	while (fgets(line, 255, fp) != NULL)
	{
		if (ferror(fp))
		{
			perror("Грешка:");
		}
		printf("%s", line);
	}
	printf("\n\n");
}

void pok(FILE *fp)
{
	char c;
	rewind(fp);
	printf("Въведете символ:\n");
	c = getchar();
	scanf("%c", &c);
	count(fp, c);

}
int main()
{
	FILE *f = 0;
	FILE *fo = 0;
	int mode = 0, cmode = 0;
	char name[256];
	char line[256];
	char a, b, c = 0, d = 0;

	SetConsoleOutputCP(1251);
	SetConsoleCP(1251);

	do
	{
		mode = menu(mode);
		switch (mode)
		{
		case 1:
			f = file(name);
			break;
		case 2:
			if (f == NULL)
			{
				printf("\nМоля първо отворете файл\n\n");
				break;
			}
			tekst(f);
			break;
		case 3:
			if (f == NULL)
			{
				printf("\nМоля първо отворете файл\n\n");
				break;
			}
			tablica(f, fo);
			break;
		case 4:
			if (f == NULL)
			{
				printf("\nМоля първо отворете файл\n\n");
				break;
			}
			pok(f);
			break;
		case 5:
			if (f == NULL)
			{
				printf("\nМоля първо отворете файл\n\n");
				break;
			}
			replace(f, fo);
			break;
		case 6:
			if (f == NULL)
			{
				printf("\nМоля първо отворете файл\n\n");
				break;
			}

			cmode = cmenu(cmode);
			switch (cmode)
			{
			case 1:
				maxi(f);
				break;
			case 2:
				interval(f);
				break;
			case 3:
				sred(f);
				break;
			case 4:
				otr(f, fo);
				break;
			case 5:break;
			}

			break;
		case 7:printf("Ciao\n");
		}
	} while (mode != 7);

	_getche();
	return 0;
}
