#define _CRT_SECURE_NO_WARNINGS 
#define _GNU_SOURCE
#include <stdio.h>
#include <conio.h>
#include <stdlib.h>
#include <string.h>

int GetCommentsNumber(FILE* inputFile)
{
	int numberOfComments = 0;
	int multylineComment = 0;
	char line[256];
	char currentChar;

	while ((currentChar = fgetc(inputFile)) != EOF) //Chete dokato ne stingne krai na faila
	{
		int i = 0;
		while (currentChar != '\n' && currentChar != EOF)//Prochite 1 red
		{
			line[i++] = currentChar; //Zapisva v line
			currentChar = fgetc(inputFile);
		}

		line[i] = '\0';
		if (i != 0) //Ima procheten red
		{
			for (size_t j = 0; j < i - 1; j++)
			{
				if (line[j] == '/' && multylineComment == 0)
				{
					if (line[j + 1] == '/')
					{
						numberOfComments++;
					}
					else if (line[j + 1] == '*')
					{
						multylineComment = 1;
					}
				}
				else if (line[j] == '*' && line[j + 1] == '/')
				{
					multylineComment = 0;
					numberOfComments++;
				}
			}
		}
	}

	return numberOfComments;
}

int FindKeyword(char* word, char* text)
{
	size_t wordLen = strlen(word);
	size_t textLen = strlen(text);
	int flag = 0;

	for (size_t i = 0; i < textLen; i++)
	{
		flag = 0;
		if (text[i] == word[0])
		{
			for (size_t j = 1; j < wordLen; j++)
			{
				if (text[i+j] != word[j])
				{
					flag = 1;
					break;
				}
			}
			if (flag == 0)
			{
				return 1;
			}
		}
	}
	
	return 0;
}

int GetLoopsNumber(FILE* inputFile)
{
	int numberOfLoops = 0;
	char line[256];
	char currentChar;

	while ((currentChar = fgetc(inputFile)) != EOF)
	{
		int i = 0;
		while (currentChar != '\n' && currentChar != EOF)
		{
			line[i++] = currentChar;
			currentChar = fgetc(inputFile);
		}

		line[i] = '\0';
		if (i != 0)
		{
			numberOfLoops += FindKeyword("\tfor(", line);
			numberOfLoops += FindKeyword("\tfor (", line);

			numberOfLoops += FindKeyword("\twhile(", line);
			numberOfLoops += FindKeyword("\twhile (", line);

			numberOfLoops += FindKeyword("}while(", line);
			numberOfLoops += FindKeyword("}while (", line);

			numberOfLoops += FindKeyword(" while(", line);
			numberOfLoops += FindKeyword(" while (", line);
		}
	}

	return numberOfLoops;
}

int main()
{
	FILE* inputFile;
	inputFile = fopen("Example.txt", "rt");

	int n = GetCommentsNumber(inputFile);
	printf("Komentari: %d\n", n);
	rewind(inputFile);
	int m = GetLoopsNumber(inputFile);
	printf("Cikli: %d\n", m);

	fclose(inputFile);

	_getch();
	return 0;
}
